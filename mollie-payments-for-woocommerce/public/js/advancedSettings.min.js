!function({_:e}){function t(e,t,n){e.setRangeText?n?e.setRangeText(t,e.selectionStart,e.selectionEnd,"end"):e.setRangeText(t,e.value.length,e.value.length,"end"):(e.focus(),document.execCommand("insertText",!1,t)),e.focus()}function n(){const e=document.querySelector('[name="mollie-payments-for-woocommerce_place_payment_onhold"]');e&&(s(e),e.addEventListener("change",function(){s(e)}))}function s(e){const t=e.querySelector("option:checked");if(!t)return;const n=document.querySelector('[name="mollie-payments-for-woocommerce_capture_or_void"]');if(!n)return;const s=n.closest("tr");s&&("later_capture"===t.value?s.style.display="":s.style.display="none")}const o={button:null,spinner:null,result:null,checkoutPanel:null,currentTestId:null,init:function(){this.cacheElements(),this.button&&(this.bindEvents(),this.createCheckoutPanel())},cacheElements:function(){this.button=document.getElementById("mollie-webhook-test-button"),this.button&&(this.spinner=this.button.parentElement.querySelector(".spinner"),this.result=document.getElementById("mollie-webhook-test-result"))},createCheckoutPanel:function(){this.result&&(this.checkoutPanel=document.createElement("div"),this.checkoutPanel.id="mollie-webhook-checkout-panel",this.checkoutPanel.className="mollie-webhook-checkout-panel",this.checkoutPanel.style.display="none",this.result.parentElement.insertBefore(this.checkoutPanel,this.result.nextSibling))},bindEvents:function(){this.button.addEventListener("click",this.handleButtonClick.bind(this))},handleButtonClick:function(e){e.preventDefault(),this.button.disabled||this.startTest()},startTest:function(){this.setButtonState(!0),this.showSpinner(!0),this.clearResult(),this.hideCheckoutPanel();const e=this.button.dataset.nonce;this.showResult("info",mollieWebhookTestData.messages.creating||"Creating test payment..."),this.initiateWebhookTest(e)},initiateWebhookTest:function(e){const t=new FormData;t.append("action","mollie_webhook_test_initiate"),t.append("nonce",e),fetch(mollieWebhookTestData.ajaxUrl,{method:"POST",body:t,credentials:"same-origin"}).then(e=>e.json()).then(this.handleInitiateSuccess.bind(this)).catch(this.handleInitiateError.bind(this))},handleInitiateSuccess:function(e){if(!e.success)return this.showResult("error",e.data?.message||mollieWebhookTestData.messages.error),this.setButtonState(!1),void this.showSpinner(!1);const t=e.data.test_id,n=e.data.checkout_url;this.currentTestId=t,n?this.showCheckoutInstructions(n,t):(this.showResult("info",mollieWebhookTestData.messages.waiting),this.pollWebhookResult(t))},showCheckoutInstructions:function(e,t){this.showSpinner(!1),this.setButtonState(!0),this.showResult("info",mollieWebhookTestData.messages.checkoutRequired||"Please complete the test payment to trigger the webhook.");const n=`\n                <div class="mollie-checkout-instructions">\n                    <p><strong>${mollieWebhookTestData.messages.step1||"Step 1:"}</strong> ${mollieWebhookTestData.messages.clickCheckout||"Click the button below to open the Mollie test payment page in a new tab."}</p>\n                    <p>\n                        <a href="${e}" target="_blank" class="button button-primary" id="mollie-open-checkout">\n                            ${mollieWebhookTestData.messages.openCheckout||"Open Test Payment Page"}\n                        </a>\n                    </p>\n                    <p><strong>${mollieWebhookTestData.messages.step2||"Step 2:"}</strong> ${mollieWebhookTestData.messages.selectStatus||'Select a payment status (e.g., "Paid" or "Failed") on the Mollie page.'}</p>\n                    <p><strong>${mollieWebhookTestData.messages.step3||"Step 3:"}</strong> ${mollieWebhookTestData.messages.clickVerify||"Come back here and click the button below to verify the webhook was received."}</p>\n                    <p>\n                        <button type="button" class="button button-secondary" id="mollie-verify-webhook">\n                            ${mollieWebhookTestData.messages.verifyWebhook||"Verify Webhook"}\n                        </button>\n                        <button type="button" class="button" id="mollie-cancel-test">\n                            ${mollieWebhookTestData.messages.cancelTest||"Cancel Test"}\n                        </button>\n                    </p>\n                </div>\n            `;this.checkoutPanel.innerHTML=n,this.checkoutPanel.style.display="block";const s=document.getElementById("mollie-verify-webhook"),o=document.getElementById("mollie-cancel-test");s&&s.addEventListener("click",()=>{this.showSpinner(!0),this.showResult("info",mollieWebhookTestData.messages.waiting),this.pollWebhookResult(t)}),o&&o.addEventListener("click",()=>{this.cancelTest()})},hideCheckoutPanel:function(){this.checkoutPanel&&(this.checkoutPanel.style.display="none",this.checkoutPanel.innerHTML="")},cancelTest:function(){this.currentTestId=null,this.hideCheckoutPanel(),this.clearResult(),this.setButtonState(!1),this.showSpinner(!1)},handleInitiateError:function(e){const t=e.message||mollieWebhookTestData.messages.error;this.showResult("error",t),this.setButtonState(!1),this.showSpinner(!1)},pollWebhookResult:function(e,t=0){if(t>=40)return this.showResult("warning",mollieWebhookTestData.messages.timeout),this.hideCheckoutPanel(),this.setButtonState(!1),void this.showSpinner(!1);20===t&&this.showResult("info",mollieWebhookTestData.messages.takingLong),setTimeout(()=>{const n=new FormData;n.append("action","mollie_webhook_test_check"),n.append("test_id",e),n.append("nonce",this.button.dataset.nonce),fetch(mollieWebhookTestData.ajaxUrl,{method:"POST",body:n,credentials:"same-origin"}).then(e=>e.json()).then(n=>{n.success&&n.data.completed?this.handleTestComplete(n.data):this.pollWebhookResult(e,t+1)}).catch(()=>{this.pollWebhookResult(e,t+1)})},500)},handleTestComplete:function(e){const t=e.webhook_received?"success":"error",n=e.message||(e.webhook_received?mollieWebhookTestData.messages.success:mollieWebhookTestData.messages.noWebhook);this.showResult(t,n),this.hideCheckoutPanel(),this.setButtonState(!1),this.showSpinner(!1),this.currentTestId=null},setButtonState:function(e){this.button.disabled=e},showSpinner:function(e){this.spinner&&(this.spinner.style.visibility=e?"visible":"hidden")},showResult:function(e,t){this.result&&(this.result.className="mollie-webhook-test-result "+e,this.result.innerHTML=t,this.result.style.display="block")},clearResult:function(){this.result&&(this.result.style.display="none",this.result.innerHTML="",this.result.className="mollie-webhook-test-result")}};function i(){document.querySelectorAll(".mollie-settings-advanced-payment-desc-label").forEach(function(e){let n=!1;e.addEventListener("mousedown",function(s){const o=document.getElementById("mollie-payments-for-woocommerce_api_payment_description");if(document.activeElement&&o===document.activeElement){const s=function(s){n=!0,i();const l=e.dataset.tag;t(o,l,!0)},i=function(){e.removeEventListener("mouseup",s),window.removeEventListener("mouseup",l),window.removeEventListener("drag",l),window.removeEventListener("blur",l)},l=function(){i()};e.addEventListener("mouseup",s),window.addEventListener("mouseup",l),window.addEventListener("drag",l),window.addEventListener("blur",l)}}),e.addEventListener("click",function(s){if(s.preventDefault(),s.stopImmediatePropagation(),n)n=!1;else{const n=e.dataset.tag;t(document.getElementById("mollie-payments-for-woocommerce_api_payment_description"),n,!1)}})})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){i(),n(),o.init()}):(i(),n(),o.init())}(window);